<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Differences to ros_control (ROS1) &mdash; ROS2_Control: Humble Sep 2023 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon_ros-controls.ico"/>
    <link rel="canonical" href="https://control.ros.org/rolling//humble/doc/differences_to_ros1/differences_to_ros1.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=a915bb22"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Supported Robots" href="../supported_robots/supported_robots.html" />
    <link rel="prev" title="gazebo_ros2_control" href="../gazebo_ros2_control/doc/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo_ros-controls.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros2_control/doc/index.html">ros2_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros2_controllers/doc/controllers_index.html">ros2_controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros2_control_demos/doc/index.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros2_control/ros2controlcli/doc/userdoc.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simulators/simulators.html">Simulator Integrations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Differences to ros_control (ROS1)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hardware-structures-classes">Hardware Structures - classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-interfaces">Hardware Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#controller-s-access-to-hardware">Controller’s Access to Hardware</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#migration-guide-to-ros2-control">Migration Guide to ros2_control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#robothardware-to-components">RobotHardware to Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#controller-migration">Controller Migration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../supported_robots/supported_robots.html">Supported Robots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_ideas.html">Project Ideas for GSoC 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements/acknowledgements.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ROS2_Control: Humble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Differences to ros_control (ROS1)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ros-controls/control.ros.org/blob/humble//doc/differences_to_ros1/differences_to_ros1.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="differences-to-ros-control-ros1">
<span id="diff-to-ros1"></span><h1>Differences to ros_control (ROS1)<a class="headerlink" href="#differences-to-ros-control-ros1" title="Link to this heading"></a></h1>
<section id="hardware-structures-classes">
<h2>Hardware Structures - classes<a class="headerlink" href="#hardware-structures-classes" title="Link to this heading"></a></h2>
<p>The ros_control framework uses the <code class="docutils literal notranslate"><span class="pre">RobotHW</span></code> class as a rigid structure to handle any hardware.
This makes it impossible to extend the existing robot with additional hardware, like sensors, actuators, and tools, without coding.
The <code class="docutils literal notranslate"><span class="pre">CombinedRobotHardware</span></code> corrects this drawback.
Still, this solution is not optimal, especially when combining robots with external sensors.</p>
<p>The ros2_control framework defines three types of hardware <code class="docutils literal notranslate"><span class="pre">Actuator</span></code>, <code class="docutils literal notranslate"><span class="pre">Sensor</span></code> and <code class="docutils literal notranslate"><span class="pre">System</span></code>.
Using a combination (composition) of those basic components, any physical robotic cell (robot and its surrounding) can be described.
This also means that multi-robot, robot-sensor, robot-gripper combinations are supported out of the box.
Section <a class="reference external" href="#hardware-components">Hardware Components</a> describes this in detail.</p>
</section>
<section id="hardware-interfaces">
<h2>Hardware Interfaces<a class="headerlink" href="#hardware-interfaces" title="Link to this heading"></a></h2>
<p>The ros_control framework allows only three types of interfaces (joints), i.e., <code class="docutils literal notranslate"><span class="pre">position</span></code>, <code class="docutils literal notranslate"><span class="pre">velocity</span></code>, and <code class="docutils literal notranslate"><span class="pre">effort</span></code>. The <code class="docutils literal notranslate"><span class="pre">RobotHW</span></code> class makes it very hard to use any other data to control the robot.</p>
<p>The ros2_control approach does not enforce a fixed set of interface types, but they are defined as strings in <a class="reference external" href="#hardware-description-in-urdf">hardware’s description</a>.
To ensure compatibility of standard controllers, standard interfaces are defined as constants in <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/types/hardware_interface_type_values.hpp">hardware_interface package</a>.</p>
</section>
<section id="controller-s-access-to-hardware">
<h2>Controller’s Access to Hardware<a class="headerlink" href="#controller-s-access-to-hardware" title="Link to this heading"></a></h2>
<p>In ros_control, the controllers had direct access to the <code class="docutils literal notranslate"><span class="pre">RobotHW</span></code> class requesting access to its interfaces (joints).
The hardware itself then took care of registered interfaces and resource conflicts.</p>
<p>In ros2_control, <code class="docutils literal notranslate"><span class="pre">ResourceManager</span></code> takes care of the state of available interfaces in the framework and enables controllers to access the hardware.
Also, the controllers do not have direct access to hardware anymore, but they register their interfaces to the <code class="docutils literal notranslate"><span class="pre">ControllerManager</span></code>.</p>
</section>
</section>
<section id="migration-guide-to-ros2-control">
<h1>Migration Guide to ros2_control<a class="headerlink" href="#migration-guide-to-ros2-control" title="Link to this heading"></a></h1>
<section id="robothardware-to-components">
<h2>RobotHardware to Components<a class="headerlink" href="#robothardware-to-components" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>The implementation of <code class="docutils literal notranslate"><span class="pre">RobotHW</span></code> is not used anymore.
This should be migrated to <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/system_interface.hpp">SystemInterface</a> class or, for more granularity, <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/sensor_interface.hpp">SensorInterface</a> and <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/actuator_interface.hpp">ActuatorInterface</a>.
See the above description of “Hardware Components” to choose a suitable strategy.</p></li>
<li><p>Decide which component type is suitable for your case. Maybe it makes sense to separate <code class="docutils literal notranslate"><span class="pre">RobotHW</span></code> into multiple components.</p></li>
<li><p>Implement <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/actuator_interface.hpp">ActuatorInterface</a>, <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/sensor_interface.hpp">SensorInterface</a> or <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/system_interface.hpp">SystemInterface</a> classes as follows:</p>
<ol class="arabic simple">
<li><p>In the constructor, initialize all variables needed for communication with your hardware or define the default one.</p></li>
<li><p>In the configure function, read all the parameters your hardware needs from the parsed URDF snippet (i.e., from the <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/hardware_info.hpp">HardwareInfo</a> structure). Here you can cross-check if all joints and interfaces in URDF have allowed values or a combination of values.</p></li>
<li><p>Define interfaces to and from your hardware using <code class="docutils literal notranslate"><span class="pre">export_*_interfaces</span></code> functions.
The names are <code class="docutils literal notranslate"><span class="pre">&lt;joint&gt;/&lt;interface&gt;</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">joint_a2/position</span></code>).
This can be extracted from the <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/hardware_info.hpp">HardwareInfo</a> structure or be hard-coded if sensible.</p></li>
<li><p>Implement <code class="docutils literal notranslate"><span class="pre">start()</span></code> and <code class="docutils literal notranslate"><span class="pre">stop()</span></code> methods for your hardware.
This usually includes changing the hardware state to receive commands or set it into a safe state before interrupting the command stream.
It can also include starting and stopping communication.</p></li>
<li><p>Implement <code class="docutils literal notranslate"><span class="pre">read()</span></code> and <code class="docutils literal notranslate"><span class="pre">write()</span></code> methods to exchange commands with the hardware.
This method is equivalent to those from <code class="docutils literal notranslate"><span class="pre">RobotHW</span></code>-class in ROS 1.</p></li>
<li><p>Do not forget the <code class="docutils literal notranslate"><span class="pre">PLUGINLIB_EXPORT_CLASS</span></code> macro at the end of the .cpp file.</p></li>
</ol>
</li>
<li><p>Create .xml library description for the pluginlib, for example see <a class="reference external" href="https://github.com/ros-controls/ros2_control_demos/blob/master/example_1/ros2_control_demo_example_1.xml">RRBotSystemPositionOnlyHardware</a>.</p></li>
</ol>
</section>
<section id="controller-migration">
<h2>Controller Migration<a class="headerlink" href="#controller-migration" title="Link to this heading"></a></h2>
<p>An excellent example of a migrated controller is the <a class="reference external" href="https://github.com/ros-controls/ros2_controllers/blob/master/joint_trajectory_controller/src/joint_trajectory_controller.cpp">JointTrajectoryController</a>.
The real-time critical methods are marked as such.</p>
<ol class="arabic simple">
<li><p>Implement <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/controller_interface/include/controller_interface/controller_interface.hpp">ControllerInterface</a> class as follows:</p>
<ol class="arabic simple">
<li><p>If there are any member variables, initialized those in the constructor.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">init()</span></code> method, first call <code class="docutils literal notranslate"><span class="pre">ControllerInterface::init()</span></code> to initialize the lifecycle of the controller. Following this, declare all parameters defining their default values.</p></li>
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">state_interface_configuration()</span></code> and <code class="docutils literal notranslate"><span class="pre">command_interface_configuration()</span></code> methods.</p></li>
<li><p>Design the <code class="docutils literal notranslate"><span class="pre">update()</span></code> function for the controller. (<strong>real-time</strong>)</p></li>
<li><dl class="simple">
<dt>Add the required lifecycle management methods (others are optional):</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">on_configure()</span></code> - reads parameters and configures controller.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on_activate()</span></code> - called when controller is activated (started) (<strong>real-time</strong>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on_deactivate()</span></code> - called when controller is deactivated (stopped) (<strong>real-time</strong>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Finally, do not forget to add the <code class="docutils literal notranslate"><span class="pre">PLUGINLIB_EXPORT_CLASS</span></code> macro at the end of the .cpp file.</p></li>
</ol>
</li>
<li><p>Create .xml library description for the pluginlib, for example see <a class="reference external" href="https://github.com/ros-controls/ros2_controllers/blob/master/joint_trajectory_controller/joint_trajectory_plugin.xml">joint_trajectory_plugin.xml</a>.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../gazebo_ros2_control/doc/index.html" class="btn btn-neutral float-left" title="gazebo_ros2_control" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../supported_robots/supported_robots.html" class="btn btn-neutral float-right" title="Supported Robots" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ros2_control Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: humble
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>In Development</dt>
      <dd><a href="../../../master/doc/differences_to_ros1/differences_to_ros1.html">Master (latest)</a></dd>
    </dl>
    <dl>
      <dt>Releases</dt>
        <dd><a href="../../../iron/doc/differences_to_ros1/differences_to_ros1.html">Iron (recommended)</a></dd><br>
        <dd><a href="differences_to_ros1.html">Humble</a></dd><br>
        <dd><a href="../../../galactic/doc/differences_to_ros1/differences_to_ros1.html">Galactic (EOL)</a></dd><br>
        
        <dd><a href="../../../foxy/doc/differences_to_ros1/differences_to_ros1.html">Foxy (EOL)</a></dd><br>
        
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>