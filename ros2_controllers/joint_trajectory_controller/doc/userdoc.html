

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>joint_trajectory_controller &mdash; control.ros.org  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon_ros-controls.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="position_controllers" href="../../position_controllers/doc/userdoc.html" />
    <link rel="prev" title="forward_command_controller" href="../../forward_command_controller/doc/userdoc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> control.ros.org
          

          
            
            <img src="../../../_static/logo_ros-controls.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html#architecture">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html#hardware-components">Hardware Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control/doc/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control/doc/index.html#core-functionalities">Core functionalities</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../doc/controllers_index.html">ros2_controllers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#nomenclature">Nomenclature</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#id1">Controllers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../doc/controllers_index.html#guidelines-and-best-practices">Guidelines and Best Practices</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../doc/writing_new_controller.html">Writing a new controller</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../doc/controllers_index.html#available-controllers">Available Controllers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../diff_drive_controller/doc/userdoc.html">Differential Drive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../forward_command_controller/doc/userdoc.html">Forward Command</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Joint Trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../position_controllers/doc/userdoc.html">Position Controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../velocity_controllers/doc/userdoc.html">Velocity Controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../effort_controllers/doc/userdoc.html">Effort Controllers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../doc/controllers_index.html#available-broadcasters">Available Broadcasters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control/ros2controlcli/doc/userdoc.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../differences_to_ros1.html">Differences to ros_control (ROS1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../differences_to_ros1.html#migration-guide-to-ros2-control">Migration Guide to ros2_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control_demos/doc/index.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Pull Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html#rules-for-the-repositories-and-process-of-merging-pull-requests">Rules for the repositories and process of merging pull requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html#writing-documentation">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html#repository-structure-and-ci-configuration">Repository structure and CI configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">control.ros.org</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../doc/controllers_index.html">ros2_controllers</a> &raquo;</li>
        
      <li>joint_trajectory_controller</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/ros-controls/control.ros.org/blob/master/ros2_controllers/joint_trajectory_controller/doc/userdoc.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="joint-trajectory-controller">
<span id="joint-trajectory-controller-userdoc"></span><h1>joint_trajectory_controller<a class="headerlink" href="#joint-trajectory-controller" title="Permalink to this headline">¶</a></h1>
<p>Controller for executing joint-space trajectories on a group of joints. Trajectories are specified as a set of waypoints to be reached at specific time instants, which the controller attempts to execute as well as the mechanism allows. Waypoints consist of positions, and optionally velocities and accelerations.</p>
<div class="section" id="trajectory-representation">
<h2>Trajectory representation<a class="headerlink" href="#trajectory-representation" title="Permalink to this headline">¶</a></h2>
<p>The controller is templated to work with multiple trajectory representations. By default, a spline interpolator is provided, but it’s possible to support other representations. The spline interpolator uses the following interpolation strategies depending on the waypoint specification:</p>
<blockquote>
<div><p>Linear: Only position is specified. Guarantees continuity at the position level. Discouraged because it yields trajectories with discontinuous velocities at the waypoints.</p>
<p>Cubic: Position and velocity are specified. Guarantees continuity at the velocity level.</p>
<p>Quintic: Position, velocity and acceleration are specified: Guarantees continuity at the acceleration level.</p>
</div></blockquote>
</div>
<div class="section" id="hardware-interface-type">
<h2>Hardware interface type<a class="headerlink" href="#hardware-interface-type" title="Permalink to this headline">¶</a></h2>
<p>The controller is templated to work with multiple hardware interface types. Currently joints with position, velocity and effort interfaces are supported. For position-controlled joints, desired positions are simply forwarded to the joints; while for velocity (effort) joints, the position+velocity trajectory following error is mapped to velocity (effort) commands through a PID loop. Example controller configurations can be found here.</p>
<p>Similarly to the trajectory representation case above, it’s possible to support new hardware interfaces, or alternative mappings to an already supported interface (eg. a proxy controller for generating effort commands).</p>
</div>
<div class="section" id="other-features">
<h2>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Realtime-safe implementation.</p>
<p>Proper handling of wrapping (continuous) joints.</p>
<p>Robust to system clock changes: Discontinuous system clock changes do not cause discontinuities in the execution of already queued trajectory segments.</p>
</div></blockquote>
</div>
<div class="section" id="using-joint-trajectory-controller-s">
<h2>Using Joint Trajectory Controller(s)<a class="headerlink" href="#using-joint-trajectory-controller-s" title="Permalink to this headline">¶</a></h2>
<p>The controller expects at least position feedback from the hardware.
Joint velocities and accelerations are optional.
Currently the controller does not internally integrate velocity from acceleration and position from velocity.
Therefore if the hardware provides only acceleration or velocity states they have to be integrated in the hardware-interface implementation of velocity and position to use these controllers.</p>
<p>The generic version of Joint Trajectory controller is implemented in this package.
A yaml file for using it could be:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">controller_manager</span><span class="p">:</span>
  <span class="nt">ros__parameters</span><span class="p">:</span>
    <span class="nt">joint_trajectory_controller</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;joint_trajectory_controller/JointTrajectoryController&quot;</span>

<span class="nt">joint_trajectory_controller</span><span class="p">:</span>
  <span class="nt">ros__parameters</span><span class="p">:</span>
    <span class="nt">joints</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">joint1</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">joint2</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">joint3</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">joint4</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">joint5</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">joint6</span>

    <span class="nt">command_interfaces</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">position</span>

    <span class="nt">state_interfaces</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">position</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">velocity</span>

    <span class="nt">state_publish_rate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50.0</span>
    <span class="nt">action_monitor_rate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20.0</span>

    <span class="nt">allow_partial_joints_goal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">open_loop_control</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">constraints</span><span class="p">:</span>
      <span class="nt">stopped_velocity_tolerance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.01</span>
      <span class="nt">goal_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0</span>
      <span class="nt">joint1</span><span class="p">:</span>
        <span class="nt">trajectory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.05</span>
        <span class="nt">goal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.03</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="details-about-parameters">
<h3>Details about parameters<a class="headerlink" href="#details-about-parameters" title="Permalink to this headline">¶</a></h3>
<dl>
<dt>joint (list(string)):</dt><dd><p>Joint names to control.</p>
</dd>
<dt>command_interface (list(string)):</dt><dd><p>Command interfaces provided by the hardware interface for all joints.</p>
<p>Values: [position | velocity | acceleration] (multiple allowed)</p>
</dd>
<dt>state_interfaces (list(string)):</dt><dd><p>State interfaces provided by the hardware for all joints.</p>
<p>Values: position (mandatory) [velocity, [acceleration]].
Acceleration interface can only be used in combination with position and velocity.</p>
<p>Default: 50.0</p>
</dd>
<dt>state_publish_rate (double):</dt><dd><p>Publish-rate of the controller’s “state” topic.</p>
<p>Default: 20.0</p>
</dd>
<dt>action_monitor_rate (double):</dt><dd><p>Rate to monitor status changes when the controller is executing action (control_msgs::action::FollowJointTrajectory).</p>
</dd>
<dt>allow_partial_joints_goal (boolean):</dt><dd><p>Allow joint goals defining trajectory for only some joints.</p>
</dd>
<dt>open_loop_control (boolean):</dt><dd><p>Use controller in open-loop control mode using ignoring the states provided by hardware interface and using last commands as states in the next control step. This is useful if hardware states are not following commands, i.e., an offset between those (typical for hydraulic manipulators).</p>
<p>If this flag is set, the controller tries to read the values from the command interfaces on starting. If they have real numeric values, those will be used instead of state interfaces. Therefore it is important set command interfaces to NaN (std::numeric_limits&lt;double&gt;::quiet_NaN()) or state values when the hardware is started.</p>
</dd>
<dt>constraints (structure)</dt><dd><p>Default values for tolerances if no explicit values are states in JointTrajectory message.</p>
</dd>
<dt>constraints.stopped_velocity_tolerance (double)</dt><dd><p>Default value for end velocity deviation.</p>
<p>Default: 0.01</p>
</dd>
<dt>constraints.goal_time (double)</dt><dd><p>Maximally allowed tolerance for not reaching the end of the trajectory in a predefined time.</p>
<p>Default: 0.0 (not checked)</p>
</dd>
<dt>constraints.&lt;joint_name&gt;.trajectory</dt><dd><p>Maximally allowed deviation from the target trajectory for a given joint.</p>
<p>Default: 0.0 (tolerance is not enforced)</p>
</dd>
<dt>constraints.&lt;joint_name&gt;.goal</dt><dd><p>Maximally allowed deviation from the goal (end of the trajectory) for a given joint.</p>
<p>Default: 0.0 (tolerance is not enforced)</p>
</dd>
</dl>
</div>
<div class="section" id="ros2-interface-of-the-controller">
<h3>ROS2 interface of the controller<a class="headerlink" href="#ros2-interface-of-the-controller" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>~/joint_trajectory (input topic) [trajectory_msgs::msg::JointTrajectory]</dt><dd><p>Topic for commanding the controller.</p>
</dd>
<dt>~/state (output topic) [control_msgs::msg::JointTrajectoryControllerState]</dt><dd><p>Topic publishing internal states.</p>
</dd>
<dt>~/follow_joint_trajectory (action server) [control_msgs::action::FollowJointTrajectory]</dt><dd><p>Action server for commanding the controller.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="specialized-versions-of-jointtrajectorycontroller-tbd-in">
<h2>Specialized versions of JointTrajectoryController (TBD in …)<a class="headerlink" href="#specialized-versions-of-jointtrajectorycontroller-tbd-in" title="Permalink to this headline">¶</a></h2>
<p>The controller types are placed into namespaces according to their command types for the hardware (see <a class="reference external" href="../../index.rst">general introduction into controllers</a>).</p>
<p>The following version of the Joint Trajectory Controller are available mapping the following interfaces:</p>
<blockquote>
<div><ul class="simple">
<li><p>position_controllers::JointTrajectoryController
- Input: position, [velocity, [acceleration]]
- Output: position</p></li>
<li><p>position_velocity_controllers::JointTrajectoryController
- Input: position, [velocity, [acceleration]]
- Output: position and velocity</p></li>
<li><p>position_velocity_acceleration_controllers::JointTrajectoryController
- Input: position, [velocity, [acceleration]]
- Output: position, velocity and acceleration</p></li>
</ul>
</div></blockquote>
<p>(<em>Not implemented yet</em>) When using pure <code class="docutils literal notranslate"><span class="pre">velocity</span></code> or <code class="docutils literal notranslate"><span class="pre">effort</span></code> controllers a command is generated using the desired state and state error using a velocity feedforward term plus a corrective PID term. (#171)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../../position_controllers/doc/userdoc.html" class="btn btn-neutral float-right" title="position_controllers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../../forward_command_controller/doc/userdoc.html" class="btn btn-neutral float-left" title="forward_command_controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, ros2_control Maintainers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>